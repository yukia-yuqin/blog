---
layout: post
title: dubbo
tags: dubbo 
categories: dubbo
---
since 2020-01-31，（02-09P1-P9）（2-25日 p10-p19）（2月27 P20-30完毕）
尚硅谷dubbo教程【Bilibili】 <br>
<br>


### 分布式基础知识
    - 网站应用不断扩大， 分布式服务架构以及流动计算架构势在必行，需要一个治理系统确保架构有条不紊的演进。
    - 垂直应用架构
        - 当访问量逐渐增大，单一应用增加机器带来的加速度越来越小，将应用拆成互不相干的几个应用，以提升效率。此时，用于加速前端页面开发的Web框架(MVC)是关键。
        - 通过切分业务来实现各个模块独立部署，降低了维护和部署的难度，团队各司其职更易管理，性能扩展也更方便，更有针对性。缺点： 公用模块无法重复利用，开发性的浪费
    - 分布式服务架构
        - 当垂直应用越来越多，应用之间交互不可避免，将核心业务抽取出来，作为独立的服务，逐渐形成稳定的服务中心，使前端应用能更快速的响应多变的市场需求。此时，用于提高业务复用及整合的分布式服务框架(RPC)是关键。
    - 流动计算架构
        - 当服务越来越多，容量的评估，小服务资源的浪费等问题逐渐显现，此时需增加一个调度中心基于访问压力实时管理集群容量，提高集群利用率。此时，用于提高机器利用率的资源调度和治理中心(SOA)[ Service Oriented Architecture]是关键。
    - RPC
        - RPC是一种进程间通信方式，他是一种技术的思想，而不是规范。它允许程序调用另一个地址空间（通常是共享网络的另一台机器上）的过程或函数，而不用程序员显式编码这个远程调用的细节。即程序员无论是调用本地的还是远程的函数，本质上编写的调用代码基本相同
        - RPC两个核心模块：通讯，序列化。耗时：xml > json > 二进制流
        - 典型的RPC框架，dubbo, gRPC, Thrift, HSF
    - 支持灰度发布
    - 配置有三种 xml(application properties)、dubbo properties。
    - 启动检查check依赖的服务者是否存在
    - 超时&配置覆盖
    - 配置重试次数、多版本实现灰度发布、本地存根（远程对象？）、配置与spring boot整合
    - 高可用，本地缓存，如果注册中心宕机，消费者依然可以连接到服务者。dubbo可以绕过注册中心，通过dubbo直连服务者地址调用服务。
    - dubbo支持多种负载均衡策略。随机/轮询/最少活跃数/hash
    - 服务降级。1.屏蔽。直接返回为Null 2.容错，发生错误直接返回NULL。

### dubbo原理
    - RPC原理
    - Netty通信原理
    - NIO 非阻塞IO。channel buffer selector, 发现某一个通道中的数据准备好就开一个线程执行相关工作。
    - dubbo框架设计
        - 业务层
        - RPC层
            - 配置层
            - 服务代理层
            - 注册中心层
            - 负载均衡层
            - 监控层
            - 协议层。原曾调用层。invoker, protocal,exporter。
        -远程通信层
            - 交换数据层
            - 传输层
            - 序列化层
    - dubbo启动解析
        - spring的配置文件，beandefinitionparser。
    - dubbo服务暴露
        - 包装服务，打开服务器，创建一个信息交换服务器，绑定url和信息处理器handler。（Netty底层）。启动netty服务器，监听端口。
        -  在注册表中保存url地址和执行器的绑定即可。。。
    - 服务引用的过程
    - 测试过程中断点可以导出，也可以将断点导入

### dubbo基本概念
- 官方推荐zookeeper作为注册中心
    - 下载zookeeper稳定版，
    - 客户端口号2181
    - zkCli.exe连接zookeeper服务器
    - zookeeper是一个树形目录服务
- 监控中心可以不安装，不影响后来的操作，是可视化界面来管理众多的服务。属于dubbo ops运维相关的功能。有dubbo-monitor，下载源码后以maven的方式构建起来。然后使用mvn clean package将pom.xml进行打包。就会有admin的jar包。
- 工程架构根据 dubbo《服务化最佳实践》 
    - 1、分包。建议将服务接口，服务模型，服务异常等均放在 API 包中，因为服务模型及异常也是 API 的一部分，同时，这样做也符合分包原则：重用发布等价原则(REP)，共同重用原则(CRP)。
